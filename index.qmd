---
title: "Chocolate Chip Cookies"
execute:
  error: true
author: "Xiurong Lai"
output: html_document
---

## Reading In the Data

First, read in the CSV data of cookie ingredients.
Make sure that your end-result data has appropriate types for each column - these should match the types provided in the documentation in the README.md file.

```{r}

```

```{python}
import pandas as pd 
# read csv file 
cookies_data = pd.read_csv('choc_chip_cookie_ingredients.csv')
# check 
print(cookies_data.head())
```


## Exploratory Data Analysis

Exploratory data analysis is the process of getting familiar with your dataset. To get started, [this blog post](https://www.mrdbourke.com/a-gentle-introduction-to-exploratory-data-analysis/) provides a nice checklist to get you thinking:

> 1.  What question(s) are you trying to solve (or prove wrong)?
> 2.  What kind of data do you have and how do you treat different types?
> 3.  What's missing from the data and how do you deal with it?
> 4.  Where are the outliers and why should you care about them?
> 5.  How can you add, change or remove features to get more out of your data?

### Generating Questions

Generate at least 5 questions you might explore using this database of cookie ingredients.

1. Which ingredients are the most common in cookies?
2. Are there ingredients that often appear together (like butter + salt)?
3. Which ingredients are almost never used?
4. what is the typical number of ingredients ? 
5. Are there any missing values or strange entries in the ingredient columns?


### Skimming the Data

One thing we often want to do during EDA is to examine the quality of the data - are there missing values? What quirks might exist in the dataset?

The `skimr` package in R, and the similar `skimpy` package in python (which has a much better name, in my opinion), can help provide visual summaries of the data. 

Install both packages, and read the package documentation ([R](https://cran.r-project.org/web/packages/skimr/vignettes/skimr.html), [Python](https://pypi.org/project/skimpy/)).

[Part 1] Use each package and generate summaries of your data that require the use of at least some non-default options in each package's `skim` function.


```{r}
# install package 
# install.packages("skimr")
# install.packages("readr") # read data 
# install.packages("dplyr") # glimpse 
library(skimr)
library(readr)
library(dplyr)
# read data 
cookies <- read_csv('choc_chip_cookie_ingredients.csv')
# quick check
glimpse(cookies)
# skim with some non-default options,only selected the Quantity columns
skim(cookies, Quantity)


```



```{python}
from skimpy import skim
import pandas as pd

# Read the data
cookies_data = pd.read_csv("choc_chip_cookie_ingredients.csv")

# Non-default: skim only the Quantity column
skim(cookies_data[["Quantity"]])


```

[Part 2] Write 1-2 sentences about what you can tell from each summary display you generate. Did you discover anything new about the data?

From the summary, I can see that the Quantity column has no missing values. The mean is about 2.23, and most values are relatively low. However, we cannot conclude that ingredients are used in small amounts, because different ingredients may use different units.

### Generating Tables

Another useful technique for exploratory data analysis is to generate summary tables. 
You may want to use the `dplyr` package in R (`group_by` or `count` functions), as well as the `groupby` and `count` methods in Pandas. [Python example](https://sparkbyexamples.com/pandas/pandas-groupby-count-examples/), [R example](https://dplyr.tidyverse.org/reference/count.html)

[Part 1] Using R and Python, generate a table that shows what **proportion** of recipes contain each type of ingredient, for the most common 20 ingredients.
```{r}
library(dplyr)
# Load the dplyr package for data manipulation

# Count the total number of unique recipes
total_recipes <- n_distinct(cookies$Recipe_Index)

top20_table <- cookies %>%
  # Keep only unique combinations of recipe and ingredient
  distinct(Recipe_Index, Ingredient) %>%
  
  # Count how many recipes each ingredient appears in
  count(Ingredient, name = "recipe_count") %>%
  
  # Calculate the proportion of recipes that contain each ingredient
  mutate(proportion = recipe_count / total_recipes) %>%
  
  # Sort ingredients from most common to least common
  arrange(desc(recipe_count)) %>%
  
  # Select only the top 20 most common ingredients
  slice_head(n = 20)

# Display the final table
top20_table




```
```{python}
import pandas as pd
# Import pandas for data manipulation

# Count the total number of unique recipes
total_recipes = cookies_data["Recipe_Index"].nunique()

# Create a table that counts how many recipes each ingredient appears in
top20_table = (
    cookies_data[["Recipe_Index", "Ingredient"]]
    # Keep only unique recipeâ€“ingredient pairs to avoid double counting
    .drop_duplicates()
    
    # Group by ingredient and count unique recipes
    .groupby("Ingredient")["Recipe_Index"]
    .nunique()
    
    # Convert the result back to a DataFrame
    .reset_index(name="recipe_count")
)

# Calculate the proportion of recipes that contain each ingredient
top20_table["proportion"] = top20_table["recipe_count"] / total_recipes

# Sort ingredients from most common to least common
top20_table = top20_table.sort_values(
    "recipe_count", ascending=False
).head(20)

# Display the final table
top20_table



```

[Part 2] Print out a character string that lists all of the ingredients that do not appear in at least 20 recipes.
```{r}
library(dplyr)
# Load dplyr for data manipulation

# Count how many unique recipes each ingredient appears in
ingredient_counts <- cookies %>%
  # Keep only unique combinations of recipe and ingredient
  distinct(Recipe_Index, Ingredient) %>%
  
  # Count the number of recipes for each ingredient
  count(Ingredient, name = "recipe_count")

# Select ingredients that appear in fewer than 20 recipes
rare_ingredients <- ingredient_counts %>%
  filter(recipe_count < 20) %>%
  
  # Sort ingredients alphabetically
  arrange(Ingredient) %>%
  
  # Extract only the ingredient names
  pull(Ingredient)

# Combine all rare ingredients into one string separated by commas
rare_str <- paste(rare_ingredients, collapse = ", ")

# Print the result (this is the answer for Part 2)
rare_str




```

```{python}
# Count how many unique recipes each ingredient appears in
ingredient_counts = (
    cookies_data[["Recipe_Index", "Ingredient"]]
    # Avoid double counting the same ingredient within one recipe
    .drop_duplicates()
    # For each ingredient, count the number of unique recipes
    .groupby("Ingredient")["Recipe_Index"]
    .nunique()
)

# Keep only ingredients that appear in fewer than 20 recipes
rare_ingredients = sorted(ingredient_counts[ingredient_counts < 20].index.tolist())

# Make one long string with ingredients separated by commas
rare_str = ", ".join(rare_ingredients)

# Print the result (this is the answer for Part 2)
print(rare_str)

```


### Visualization

Using whatever plotting system you are comfortable with in R or python, see if you can create a couple of useful exploratory data visualizations which address one of the questions you wrote above - or another question which you've come up with as you've worked on this assignment.

[Part 1] Create at least one plot (it doesn't have to be pretty) that showcases an interesting facet of the data.
```{r}
library(ggplot2)
# Load ggplot2 for data visualization

ggplot(top20_table, aes(
  x = reorder(Ingredient, recipe_count),
  y = recipe_count
)) +
  # Create a bar chart using the recipe count for each ingredient
  geom_col(fill = "steelblue") +
  
  # Flip the axes to make ingredient names easier to read
  coord_flip() +
  
  # Add title and axis labels to the plot
  labs(
    title = "Top 20 Most Common Ingredients",
    x = "Ingredient",
    y = "Number of Recipes"
  )



```

[Part 2] Write 2-3 sentences about what you can learn from that plot and what directions you might want to investigate from here.
From this plot, I can see that ingredients like egg, vanilla, and all purpose flour appear in the largest number of recipes. In addition, dark chocolate chip appears in 9 recipes, which suggests it is also relatively common. This shows that different types of chocolate chips are frequently used in cookie recipes. In the future, it would be interesting to explore how ingredient combinations differ across different types of cookies.